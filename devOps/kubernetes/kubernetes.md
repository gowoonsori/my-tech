# 가상화 기술의 역사

1. 자원격리기술 Linux의 자원을 분리하여 독립적으로 사용가능하게 하는 기술로 출발 (chroot, namespace, cgroup 등..)

2. VM 가상화 기술등장으로 자원을 분리가 가능했고, rackspace와 나사에서 open Stack이 등장하여 이걸 이용해 자동화를 시도 -> 자동화는 되는데 시스템 효율이 나지 않는다.

   vm가상화를 하기 위해서 무거운 os를 띄워야하고, 가벼운 서비스를 띄우기 위해 더 큰 서비스를 띄워야하는 경우도 생겨 자원이 효율적이지 않다.

3. 컨테이너 가상화 기술 (dotCloud -> docker)

   서비스간에 자원격리를 하는데 os를 별도로 안띄워도 되기 대문에 os 기동시간이 없기 때문에 자동화시 엄청 빠르고, 자원효율도 좋다.

   Docker 자체는 하나의 서비스를 컨테이너로 가상화 시켜 배포하는 것. (엄청 많은 서비스를 일일이 배포하고 운영해주는 역할x)

4. 컨테이너 오케스트레이터 (kubernates, docker swarm, ECS, Rancher Cattle,,Hashicorp Nomad ...)

   많은 서비스를 배포하고 운영하는 역할 (여러 컨테이너들을 관리해주는 기술)

# 가상화 기술의 장점

대규모의 서비스를 운영할때, 최대한 자원을 효율적으로 사용해야 비용적으로 유리하기 때문에 서버 자원을 효율적으로 사용하기 위해 가상화 기술 사용

# 컨테이너 와 VM

docker와 같은 컨테이너 가상화 기술은 Host os위에 자원격리기술이용해 컨테이너 단위로 서비스를 분리하여 개발환경에 상관없이 동작 가능하게 해준다.

아래와 같이 자원 격리 기술을 이용해 서비스를 컨테이너 단위로 구성

- namespace (mnt/pid/net/ipc/uts/user) : 커널에 관련된 영역 분리
- cgroups (memory,cpu, I/O, network) 자원에 관련된 영역 분리

VM은 Host os 위에 Hypervisor기술을 이용해 Guest OS를 구성하는 방법

VM은 하나의 VM이 보안이 뚫려도 다른 OS와는 독립적인 공간이라 안전하나 container는 한 컨테이너가 뚫리면 Host OS가 위험하다.

# 쿠버네티스

위의 역사에서 봤듯이 쿠버네티스는 컨테이너화된 애플리케이션을 자동화 관리 시스템으로 `오픈 소스 기반`이다.

구글에 의해 프로젝트가 시작되었으며, 각종 기업들이 참여해 프로젝트를 진행하였고 현재는 `리눅스 재단`이 관리

여러 컨테이너들을 `Pod`라는 개념을 이용해 컨테이너들을 묶고 분류할 수 있다.

## Kubernetes 객체 내부

서버 한대는 `Master`(쿠버네티스의 전반적인 역할)로 사용하고 `node`들은 자원을 제공하는 역할로, 이들이 묶어 `Cluster`라는 개념으로 사용하고 Cluster안에 각각의 Namespace가 존재하여 쿠버네티스 Object들을 독립된 공간으로 분리되게 만들어 준다.

한 `Pod`가 배포의 단위이고 이 Pod들을 외부와 연결하기 위해 ip와 포트등 관리하기위한 `Service`가 존재하고 Pod가 문제가 생겨 재생성이 될때 데이터가 날라가는 문제를 해결하기 위해 `volume`을 생성해 저장장치에 저장하여 데이터를 관리
이 들은 `Namespace`안에서 동작

Namespace안에 `ResourceQuota / LimitRange`를 통해 namespace안에서 사용할 수 있는 자원의 양을 조절 가능하고(pod의 개수, cpu,memory등 ) `ConfigMap/Secret`으로 Pod생성시 컨테이너 안에 환경변수 값을 넣어두는 등 세팅을 할 수있게 해준다.

또, 각각의 Pod를 관리하는 `Controller`가 존재

- Replication Controller, ReplicaSet : Pod가 죽으면 감지해 살리거나 Pod를 Scaling 해주는 controller

- Deployment : Pode의 Upgrade를 담당하는 controller
- DaemonSet : 한 노드에 한 Pod만 유지되도록 하는 역할
- CronJob : 어떤 특정 작업만 하고 종료를 시켜야하는 일을 할 수 있도록 해준다.

## 기능

---

### Auto Scaling

자동 확장으로, 특정 서비스(서버)에 트래픽이 몰리면 여유있고 쉬고 있는 서버를 자동으로 확장하여 사용하는 방법 - 트래픽이 적은 시간에는 일부 서버를 절전모드로 전환하여 전기 비용을 절약 가능 - 총 사용량으로 요금을 부과하기 때문에, 요금을 낮출 수 있다. - 트래픽에 민감하게 대응이 가능하다.

### Auto Healing

자동 복구로, 특정 서버가(인스턴스) 죽게되면 자동으로 새로운 인스턴스에 볼륨을 연결하여 기능을 수행하게 하는 방법

### Deployment

무중단 배포를 위해 자동적으로 update를 지원
